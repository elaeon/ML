<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ds &#8212; mlPyp 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="mlPyp 0.1.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mlPyp 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ds</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for create datasets from distinct sources of data.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="k">import</span> <span class="n">io</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">ml.processing</span> <span class="k">import</span> <span class="n">PreprocessingImage</span><span class="p">,</span> <span class="n">Preprocessing</span><span class="p">,</span> <span class="n">Transforms</span>
<span class="kn">from</span> <span class="nn">ml.utils.config</span> <span class="k">import</span> <span class="n">get_settings</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">(</span><span class="s2">&quot;ml&quot;</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_metadata</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">dtype_c</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;int32&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>


<div class="viewcode-block" id="DataSetBuilder"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder">[docs]</a><span class="k">class</span> <span class="nc">DataSetBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for dataset build. Get data from memory.</span>
<span class="sd">    create the initial values for the dataset.</span>

<span class="sd">    :type name: string</span>
<span class="sd">    :param name: dataset&#39;s name</span>

<span class="sd">    :type dataset_path: string</span>
<span class="sd">    :param dataset_path: path where the datased is saved. This param is automaticly set by the settings.cfg file.</span>

<span class="sd">    :type train_folder_path: string</span>
<span class="sd">    :param train_folder_path: path to the data what you want to add to the dataset, automaticly split the data in train, test and validation. If you want manualy split the data in train and test, check test_folder_path.</span>

<span class="sd">    :type test_folder_path: string</span>
<span class="sd">    :param test_folder_path: path to the test data. If None the test data is get from train_folder_path.</span>

<span class="sd">    :type transforms_global: list</span>
<span class="sd">    :param transforms_global: list of transforms for all row x column</span>

<span class="sd">    :type transforms_row: list</span>
<span class="sd">    :param transforms_row: list of transforms for each row</span>

<span class="sd">    :type transforms_apply: bool</span>
<span class="sd">    :param transforms_apply: apply transformations to the data</span>

<span class="sd">    :type processing_class: class</span>
<span class="sd">    :param processing_class: class where are defined the functions for preprocessing data.</span>

<span class="sd">    :type train_size: float</span>
<span class="sd">    :param train_size: value between [0, 1] who determine the size of the train data</span>

<span class="sd">    :type valid_size: float</span>
<span class="sd">    :param valid_size: value between [0, 1] who determine the size of the validation data</span>

<span class="sd">    :type validator: string</span>
<span class="sd">    :param validator: name of the method for extract from the data, the train data, test data and valid data</span>

<span class="sd">    :type dtype: string</span>
<span class="sd">    :param dtype: the type of the data to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> 
                <span class="n">dataset_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">test_folder_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">train_folder_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">transforms_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">transforms_global</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">transforms_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">processing_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">train_size</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span>
                <span class="n">valid_size</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">validator</span><span class="o">=</span><span class="s1">&#39;cross&#39;</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_folder_path</span> <span class="o">=</span> <span class="n">test_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_folder_path</span> <span class="o">=</span> <span class="n">train_folder_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>

        <span class="k">if</span> <span class="n">dataset_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;dataset_path&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">dataset_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span> <span class="o">=</span> <span class="n">processing_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_size</span> <span class="o">=</span> <span class="n">valid_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">=</span> <span class="n">train_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">valid_size</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms_apply</span> <span class="o">=</span> <span class="n">transforms_apply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_md5</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">validator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">transforms_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transforms_row</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transforms_row</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="n">transforms_row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transforms_global</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transforms_global</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transforms_global</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="n">transforms_global</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">Transforms</span><span class="p">([</span><span class="n">transforms_global</span><span class="p">,</span> <span class="n">transforms_row</span><span class="p">])</span>

<div class="viewcode-block" id="DataSetBuilder.url"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.url">[docs]</a>    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the path where is saved the dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSetBuilder.num_features"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.num_features">[docs]</a>    <span class="k">def</span> <span class="nf">num_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the number of features of the dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;return the shape of the dataset&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">rows</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">rows</span><span class="p">,)</span>

<div class="viewcode-block" id="DataSetBuilder.desfragment"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.desfragment">[docs]</a>    <span class="k">def</span> <span class="nf">desfragment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concatenate the train, valid and test data in a data array.</span>
<span class="sd">        Concatenate the train, valid, and test labels in another array.</span>
<span class="sd">        return data, labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span></div>

<div class="viewcode-block" id="DataSetBuilder.labels_info"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.labels_info">[docs]</a>    <span class="k">def</span> <span class="nf">labels_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a counter of labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSetBuilder.only_labels"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.only_labels">[docs]</a>    <span class="k">def</span> <span class="nf">only_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type labels: list</span>
<span class="sd">        :param labels: list of labels</span>

<span class="sd">        return a tuple of arrays with data and labels, the returned data only have the labels selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">all_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>
        <span class="n">s_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dataset</span><span class="p">,</span> <span class="n">n_labels</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">s_labels</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">all_labels</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;label </span><span class="si">{}</span><span class="s2"> is not found in the labels set&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n_labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSetBuilder.info"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type classes: bool</span>
<span class="sd">        :param classes: if true, print the detail of the labels</span>

<span class="sd">        This function print the details of the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ml.utils.order</span> <span class="k">import</span> <span class="n">order_table_print</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DATASET NAME: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transforms: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get_all_transforms</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing Class: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_processing_class_name</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MD5: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cached_md5</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;Std&quot;</span><span class="p">,</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span> <span class="s2">&quot;dType&quot;</span><span class="p">,</span> <span class="s2">&quot;Labels&quot;</span><span class="p">]</span>
            <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;train set&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;valid set&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>

            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;test set&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>
            <span class="n">order_table_print</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span> <span class="s2">&quot;dType&quot;</span><span class="p">,</span> <span class="s2">&quot;Labels&quot;</span><span class="p">]</span>
            <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;train set&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;valid set&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>

            <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;test set&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>
            <span class="n">order_table_print</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;# items&quot;</span><span class="p">]</span>
            <span class="n">order_table_print</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_info</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="s2">&quot;# items&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">cross_validators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_size</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">valid_size_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_size</span><span class="p">))</span>
        <span class="n">X_validation</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="n">valid_size_index</span><span class="p">]</span>
        <span class="n">y_validation</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[:</span><span class="n">valid_size_index</span><span class="p">]</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">valid_size_index</span><span class="p">:]</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">valid_size_index</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_validation</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_validation</span><span class="p">,</span> <span class="n">y_test</span>

<div class="viewcode-block" id="DataSetBuilder.get_processing_class_name"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.get_processing_class_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_processing_class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the name of the processing class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span><span class="o">.</span><span class="n">module_cls_name</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSetBuilder.dtype_t"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.dtype_t">[docs]</a>    <span class="k">def</span> <span class="nf">dtype_t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type data: narray</span>
<span class="sd">        :param data: narray to cast</span>

<span class="sd">        cast the data to the predefined dataset dtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype_c</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">dtype</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">object</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype_c</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span></div>

    <span class="k">def</span> <span class="nf">to_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;train_dataset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">),</span>
            <span class="s1">&#39;train_labels&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">,</span>
            <span class="s1">&#39;valid_dataset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="p">),</span>
            <span class="s1">&#39;valid_labels&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span><span class="p">,</span>
            <span class="s1">&#39;test_dataset&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_t</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">),</span>
            <span class="s1">&#39;test_labels&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span><span class="p">,</span>
            <span class="s1">&#39;transforms&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get_all_transforms</span><span class="p">(),</span>
            <span class="s1">&#39;preprocessing_class&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_processing_class_name</span><span class="p">(),</span>
            <span class="s1">&#39;md5&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">md5</span><span class="p">()}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_raw_to_ds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">DataSetBuilder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> 
                <span class="n">dataset_path</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">from_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ds</span>

    <span class="k">def</span> <span class="nf">from_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_data</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pydoc</span> <span class="k">import</span> <span class="n">locate</span>
        <span class="c1">#if self.processing_class is None:</span>
        <span class="k">if</span> <span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;preprocessing_class&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span> <span class="o">=</span> <span class="n">locate</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;preprocessing_class&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">Transforms</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;transforms&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_t</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;train_dataset&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;train_labels&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_t</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;valid_dataset&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;valid_labels&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_t</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;test_dataset&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;test_labels&#39;</span><span class="p">]</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_md5</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">shuffle_and_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validators</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">adversarial_validator_and_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">train_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">test_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span> <span class="o">=</span> <span class="n">train_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># train class is labeled as 1 </span>
        <span class="n">train_test_data_clf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clf</span><span class="p">()</span>
        <span class="n">train_test_data_clf</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">class_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">train_test_data_clf</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">class_train</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">train_test_data_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#print([(pred, index) for index, pred in predictions if pred &lt; .5])</span>
        <span class="c1">#because all targets are ones (train data) is not necessary compare it</span>
        <span class="n">false_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predictions</span> <span class="k">if</span> <span class="n">pred</span> <span class="o">&lt;</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># is a false test </span>
        <span class="n">ok_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predictions</span> <span class="k">if</span> <span class="n">pred</span> <span class="o">&gt;=</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span>
 
        <span class="n">valid_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">[</span><span class="n">false_test</span><span class="p">]</span>
        <span class="n">valid_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">[</span><span class="n">false_test</span><span class="p">]</span>
        <span class="n">valid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="n">valid_data</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">valid_size</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span> <span class="o">=</span> <span class="n">valid_labels</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">valid_size</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
            <span class="n">valid_data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">valid_size</span><span class="p">)):],</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">[</span><span class="n">ok_train</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
            <span class="n">valid_labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">valid_size</span><span class="p">)):],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">[</span><span class="n">ok_train</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">none_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> 
                        <span class="n">valid_data</span><span class="p">,</span> <span class="n">valid_labels</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">train_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">test_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="n">valid_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span> <span class="o">=</span> <span class="n">valid_labels</span>

<div class="viewcode-block" id="DataSetBuilder.save"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save the dataset in pickle format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span><span class="p">)</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_raw</span><span class="p">(),</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unable to save data to: &#39;</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_dataset_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dataset_path</span><span class="o">+</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">save</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">save</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DataSetBuilder.load_dataset"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.load_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type name: string</span>
<span class="sd">        :param name: name of the dataset to load</span>

<span class="sd">        :type dataset_path: string</span>
<span class="sd">        :param dataset_path: path where the dataset was saved</span>

<span class="sd">        :type dtype: string</span>
<span class="sd">        :param dtype: cast the data to the defined type</span>

<span class="sd">        dataset_path is not necesary to especify, this info is obtained from settings.cfg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dataset_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
             <span class="n">dataset_path</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;dataset_path&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_dataset_raw</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">DataSetBuilder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">from_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataset</span>        </div>

<div class="viewcode-block" id="DataSetBuilder.is_binary"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.is_binary">[docs]</a>    <span class="k">def</span> <span class="nf">is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return true if the labels only has two classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_info</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">to_DF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">columns_name</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_name</span><span class="p">)</span>

<div class="viewcode-block" id="DataSetBuilder.to_df"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.to_df">[docs]</a>    <span class="k">def</span> <span class="nf">to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert the dataset to a dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_DF</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">processing_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms_apply</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pdata</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">preprocessing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">(</span><span class="s1">&#39;row&#39;</span><span class="p">))</span>
                <span class="n">pdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">pipeline</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">processing_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">base_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms_apply</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#if base_data is None:</span>
                <span class="c1">#    base_data = data</span>
                <span class="kn">from</span> <span class="nn">pydoc</span> <span class="k">import</span> <span class="n">locate</span>
                <span class="n">fiter</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fiter</span> <span class="o">=</span> <span class="n">locate</span><span class="p">(</span><span class="n">fiter</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="o">=</span> <span class="n">fiter</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fit</span> <span class="o">=</span> <span class="n">fiter</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">base_data</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="DataSetBuilder.build_dataset"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.build_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">build_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                        <span class="n">valid_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">valid_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type data: ndarray</span>
<span class="sd">        :param data: array of values to save in the dataset</span>

<span class="sd">        :type labels: ndarray</span>
<span class="sd">        :param labels: array of labels to save in the dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_rows</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="n">valid_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_rows</span><span class="p">(</span><span class="n">valid_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">==</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">test_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">labels</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_and_save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">==</span> <span class="s1">&#39;adversarial&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adversarial_validator_and_save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">none_validator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">valid_data</span><span class="p">,</span> <span class="n">valid_labels</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">DataSetBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">calc_nshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>

        <span class="n">dataset</span><span class="o">.</span><span class="n">test_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_folder_path</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">train_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_folder_path</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">dataset_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_path</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="n">calc_nshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">train_labels</span> <span class="o">=</span> <span class="n">calc_nshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="n">calc_nshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_data</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">valid_labels</span> <span class="o">=</span> <span class="n">calc_nshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_labels</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">calc_nshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">test_labels</span> <span class="o">=</span> <span class="n">calc_nshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">processing_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span> <span class="nf">processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_rows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_global</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">base_data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="s1">&#39;global&#39;</span><span class="p">):</span>
            <span class="n">base_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_global</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">base_data</span><span class="o">=</span><span class="n">base_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="DataSetBuilder.subset"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.subset">[docs]</a>    <span class="k">def</span> <span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentaje</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type percentaje: float</span>
<span class="sd">        :param percentaje: value between [0, 1], this value represent the size of the dataset to copy.</span>

<span class="sd">        i.e 1 copy all dataset, .5 copy half dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">percentaje</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSetBuilder.md5"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.md5">[docs]</a>    <span class="k">def</span> <span class="nf">md5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the signature of the dataset in hex md5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">hashlib</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_md5</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_md5</span></div>

    <span class="k">def</span> <span class="nf">_clf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ml.clf.extended.w_sklearn</span> <span class="k">import</span> <span class="n">RandomForest</span>
        <span class="n">train_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">test_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">DataSetBuilder</span><span class="p">(</span><span class="s2">&quot;test_train_separability&quot;</span><span class="p">,</span> <span class="n">transforms_apply</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">build_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RandomForest</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>

<div class="viewcode-block" id="DataSetBuilder.score_train_test"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.score_train_test">[docs]</a>    <span class="k">def</span> <span class="nf">score_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the score of separability between the train data and the test data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clf</span><span class="p">()</span>
        <span class="n">classif</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">measure</span> <span class="o">=</span> <span class="s2">&quot;auc&quot;</span>
        <span class="k">return</span> <span class="n">classif</span><span class="o">.</span><span class="n">load_meta</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">measure</span><span class="p">,</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> </div>
        <span class="c1">#classif.scores(measures=&quot;f1&quot;).get_measure(&quot;f1&quot;)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">last_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">(</span><span class="s2">&quot;row&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">last_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;tsne&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">last_transform</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;concatenate&quot;</span><span class="p">:</span>                
                <span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">features_tsne</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="o">-</span><span class="n">dim</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">features_tsne</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">features_tsne</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">Preprocessing</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;tsne&quot;</span><span class="p">,</span> 
                <span class="p">{</span><span class="s2">&quot;perplexity&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;replace&quot;</span><span class="p">})])</span>

        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_info</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
        <span class="n">classes_colors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">17.5</span><span class="p">,</span> <span class="mf">17.5</span><span class="p">))</span>

        <span class="n">r_indexes</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">r_indexes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">r_indexes</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">indexes</span> <span class="ow">in</span> <span class="n">r_indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">features_index</span> <span class="o">=</span> <span class="n">features_tsne</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">features_index</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> 
                <span class="n">features_index</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">classes_colors</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> 
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
         
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
               <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="DataSetBuilder.distinct_data"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.distinct_data">[docs]</a>    <span class="k">def</span> <span class="nf">distinct_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the radio of distincts elements in the training data.</span>
<span class="sd">        i.e </span>
<span class="sd">        [1,2,3,4,5] return 5/5</span>
<span class="sd">        [2,2,2,2,2] return 1/5        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">elem</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span></div>

<div class="viewcode-block" id="DataSetBuilder.sparcity"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.sparcity">[docs]</a>    <span class="k">def</span> <span class="nf">sparcity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a value between [0, 1] of the sparcity of the dataset.</span>
<span class="sd">        0 no zeros exists, 1 all data is zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">])</span>

        <span class="n">zero_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">zero_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
    
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">zero_counter</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span></div>

<div class="viewcode-block" id="DataSetBuilder.add_transforms"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilder.add_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">add_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transforms_global</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transforms_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                        <span class="n">processing_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type transforms_global: list</span>
<span class="sd">        :param transforms_global: list of global transforms to apply</span>

<span class="sd">        :type transforms_row: list</span>
<span class="sd">        :param transforms_row: list of row transforms to apply</span>

<span class="sd">        :type processing_class: class</span>
<span class="sd">        :param processing_class: class of the row transforms</span>

<span class="sd">        :type save: bool</span>
<span class="sd">        :param save: if true the dataset with the transforms is saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">processing_class</span> <span class="o">=</span> <span class="n">processing_class</span>

        <span class="n">old_transforms</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transforms</span>
        <span class="k">if</span> <span class="n">old_transforms</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">transforms_global</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">Transforms</span><span class="p">([</span><span class="n">transforms_global</span><span class="p">,</span> <span class="n">transforms_row</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">Transforms</span><span class="p">([(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="n">transforms_row</span><span class="p">)])</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">train_data</span><span class="p">)</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">test_data</span><span class="p">)</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">valid_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">valid_data</span><span class="p">)</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">old_transforms</span> <span class="o">+</span> <span class="n">dataset</span><span class="o">.</span><span class="n">transforms</span>

        <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dataset</span></div></div>


<div class="viewcode-block" id="DataSetBuilderImage"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilderImage">[docs]</a><span class="k">class</span> <span class="nc">DataSetBuilderImage</span><span class="p">(</span><span class="n">DataSetBuilder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for images dataset build. Get the data from a directory where each directory&#39;s name is the label.</span>
<span class="sd">    </span>
<span class="sd">    :type image_size: int</span>
<span class="sd">    :param image_size: define the image size to save in the dataset</span>

<span class="sd">    kwargs are the same that DataSetBuilder&#39;s options</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DataSetBuilderImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="n">image_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">images_from_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directories</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directories</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">directories</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directories</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span>

        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">root_directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">root_directory</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_directory</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                    <span class="n">number_id</span> <span class="o">=</span> <span class="n">directory</span>
                    <span class="k">for</span> <span class="n">image_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                        <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">number_id</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">images</span>

    <span class="k">def</span> <span class="nf">images_to_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_base</span><span class="p">):</span>
        <span class="n">images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_from_directories</span><span class="p">(</span><span class="n">folder_base</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|S1&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">image_index</span><span class="p">,</span> <span class="p">(</span><span class="n">number_id</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> 
            <span class="n">labels</span><span class="p">[</span><span class="n">image_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_id</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">save_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">rewrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">n_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">number_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">n_url</span><span class="p">):</span>
             <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">n_url</span><span class="p">)</span>

        <span class="n">initial</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">rewrite</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">n_url</span><span class="p">))</span> 
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">initial</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">image_path</span> <span class="o">=</span> <span class="s2">&quot;img-</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_id</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">n_url</span><span class="p">,</span> <span class="n">image_path</span><span class="p">),</span> <span class="n">image</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index error&quot;</span><span class="p">,</span> <span class="n">n_url</span><span class="p">,</span> <span class="n">number_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">shutil</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">original_to_images_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">test_folder_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">images_data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_images</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">images</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images_data</span><span class="p">)</span>
        <span class="n">image_train</span><span class="p">,</span> <span class="n">image_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_train_test</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">images</span><span class="p">),</span> <span class="n">sample</span><span class="o">=</span><span class="n">test_folder_data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">images</span> <span class="ow">in</span> <span class="n">image_train</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_images</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_folder_path</span><span class="p">,</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">images</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">images</span> <span class="ow">in</span> <span class="n">image_test</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_images</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_folder_path</span><span class="p">,</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">images</span><span class="p">)</span>

<div class="viewcode-block" id="DataSetBuilderImage.build_dataset"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilderImage.build_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">build_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the data is extracted from the train_folder_path, and then saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_to_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_folder_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_and_save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">build_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process_images</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">images</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">images_index</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">image_array</span> <span class="ow">in</span> <span class="n">process_images</span><span class="p">:</span>
                <span class="n">images</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">number_id</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">images</span><span class="p">[</span><span class="n">number_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_array</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1">#if no faces are detected</span>
            <span class="k">return</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">sample</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">sample_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">images_good</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">number_id</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                <span class="n">base_indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">number_id</span><span class="p">])))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">sample_indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">base_indexes</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sample_indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                <span class="n">sample_data</span><span class="p">[</span><span class="n">number_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">images</span><span class="p">[</span><span class="n">number_id</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">sample_indexes</span><span class="p">]</span>
                <span class="n">images_index</span><span class="p">[</span><span class="n">number_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_indexes</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">sample_indexes</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">indexes</span> <span class="ow">in</span> <span class="n">images_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">images_good</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">number_id</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
                    <span class="n">images_good</span><span class="p">[</span><span class="n">number_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">number_id</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">images_good</span><span class="p">,</span> <span class="n">sample_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">labels_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls</span><span class="p">):</span>
        <span class="n">images_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">urls</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">number_id</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_from_directories</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
                <span class="n">images_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images_data</span><span class="p">,</span> <span class="n">labels</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DataSetBuilderImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span> <span class="nf">to_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DataSetBuilderImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_raw</span><span class="p">()</span>
        <span class="n">new</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;array_length&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">}</span>
        <span class="n">raw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">raw</span>

    <span class="k">def</span> <span class="nf">from_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DataSetBuilderImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_raw</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
        <span class="c1">#self.transforms.add_transforms(&quot;local&quot;, raw_data[&quot;local_filters&quot;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;array_length&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desfragment</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DataSetBuilderImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image Size </span><span class="si">{}</span><span class="s1">x</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">))</span></div>


<div class="viewcode-block" id="DataSetBuilderFile"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilderFile">[docs]</a><span class="k">class</span> <span class="nc">DataSetBuilderFile</span><span class="p">(</span><span class="n">DataSetBuilder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for csv dataset build. Get the data from a csv&#39;s file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DataSetBuilderFile.from_csv"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilderFile.from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">label_column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :type folder_path: string</span>
<span class="sd">        :param folder_path: path to the csv.</span>

<span class="sd">        :type label_column: string</span>
<span class="sd">        :param label_column: column&#39;s name where are the labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv2dataset</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">label_column</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">csv2dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">label_column</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">label_column</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">label_column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">labels</span>

<div class="viewcode-block" id="DataSetBuilderFile.build_dataset"><a class="viewcode-back" href="../modindex.html#ds.DataSetBuilderFile.build_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">build_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_column</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         :type label_column: string</span>
<span class="sd">         :param label_column: column&#39;s name where are the labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_folder_path</span><span class="p">,</span> <span class="n">label_column</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_folder_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="c1">#NotImplemented</span>
            <span class="c1">#test_data, test_labels = self.from_csv(self.test_folder_path, label_column)</span>
            <span class="c1">#if self.validator == &#39;cross&#39;:</span>
            <span class="c1">#    data = np.concatenate((data, test_data), axis=0)</span>
            <span class="c1">#    labels = np.concatenate((labels, test_labels), axis=0)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">==</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_and_save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adversarial_validator_and_save</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">merge_data_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">labels_path</span><span class="p">,</span> <span class="n">column_id</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
        <span class="n">labels_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">labels_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_df</span><span class="p">,</span> <span class="n">labels_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">column_id</span><span class="p">)</span></div>


</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mlPyp 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Alejandro G. Martinez Romero.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.
    </div>
  </body>
</html>